#!/bin/sh
# Pre-commit hook for .NET code formatting
# Windows-compatible version

# Check if we're on Windows and use the appropriate script
if [ "$OS" = "Windows_NT" ] || command -v cmd.exe >/dev/null 2>&1; then
    # Windows environment - use PowerShell script
    powershell.exe -ExecutionPolicy Bypass -File .git/hooks/pre-commit.ps1
    exit $?
else
    # Unix/Linux environment
    echo "Running code formatting check..."

    # Check if dotnet is available
    if ! command -v dotnet &> /dev/null; then
        echo "Error: dotnet CLI not found. Please install .NET SDK."
        exit 1
    fi

    # Verify formatting without modifying files
    dotnet format ./GsPlugin.sln --verify-no-changes 2>&1

    if [ $? -ne 0 ]; then
        echo ""
        echo "ERROR: Code formatting issues detected!"
        echo "Run 'powershell -File format-code.ps1' to fix formatting, then stage and commit again."
        exit 1
    fi

    echo "Code formatting check passed."
    exit 0
fi
